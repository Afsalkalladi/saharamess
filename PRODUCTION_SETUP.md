# üöÄ Production Environment Setup Guide

## üìã **Required Services & Accounts**

### **1. Core Services (Required)**
- ‚úÖ **Render Account** - [render.com](https://render.com) (Web hosting)
- ‚úÖ **PostgreSQL** - Render PostgreSQL service (Database)
- ‚úÖ **Telegram Bot** - @BotFather (Bot API)

### **2. Redis Service (Choose One)**
- üî• **Upstash** - [upstash.com](https://upstash.com) (Free: 10K commands/day)
- üî• **Redis Labs** - [redis.com](https://redis.com/try-free/) (Free: 30MB)
- ‚ö†Ô∏è **Skip Redis** - Set `REDIS_URL=` (tasks run synchronously)

### **3. Image Storage (Recommended)**
- üì∏ **Cloudinary** - [cloudinary.com](https://cloudinary.com) (Free: 25GB storage)

### **4. Optional Services**
- üìä **Google Sheets** - Backup logging
- üìß **Gmail SMTP** - Email notifications  
- üí≥ **Razorpay** - Payment gateway (India)

## üîê **Security Requirements**

### **Generate Secure Keys**
```bash
# Django Secret Key (50+ characters)
python -c "import secrets; print(secrets.token_urlsafe(50))"

# QR Secret (32 characters)  
python -c "import secrets; print(secrets.token_urlsafe(32))"

# Strong Admin Password
# Use: Uppercase + Lowercase + Numbers + Symbols (12+ chars)
```

### **Telegram Bot Setup**
```bash
# 1. Message @BotFather on Telegram
# 2. Send: /newbot
# 3. Bot name: "YourMessBot" 
# 4. Username: "your_mess_bot"
# 5. Copy token: 1234567890:ABCdefGHI...

# Get your Telegram ID:
# Message @userinfobot ‚Üí Copy ID: 123456789
```

## üåê **Render Environment Variables**

Copy these to your Render Web Service environment variables:

### **üî• Critical Variables (Must Configure)**
```bash
# Django Core
DJANGO_SETTINGS_MODULE=mess_management.settings.production
SECRET_KEY=your-50-character-secret-key-from-generator-above
DEBUG=False
ALLOWED_HOSTS=your-app-name.onrender.com

# Database (Auto-generated by Render PostgreSQL)
DATABASE_URL=postgresql://postgres:password@host:5432/database

# Telegram Bot (From @BotFather)
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
ADMIN_TG_IDS=123456789

# Security
QR_SECRET=your-32-character-qr-secret-from-generator-above
STAFF_SCANNER_PASSWORD=YourSecurePassword123!
```

### **üîß Redis Configuration (Choose One)**
```bash
# Option 1: Upstash Redis (Recommended)
REDIS_URL=redis://default:password@us1-xxxxx.upstash.io:6379

# Option 2: Redis Labs  
REDIS_URL=redis://default:password@redis-xxxxx.cloud.redislabs.com:6379

# Option 3: No Redis (Simplest)
REDIS_URL=
```

### **üì∏ Cloudinary (Recommended for Images)**
```bash
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=123456789012345  
CLOUDINARY_API_SECRET=your-api-secret
```

### **üõ°Ô∏è Security Headers**
```bash
SECURE_SSL_REDIRECT=True
SECURE_PROXY_SSL_HEADER=HTTP_X_FORWARDED_PROTO,https
CSRF_COOKIE_SECURE=True
SESSION_COOKIE_SECURE=True
```

### **‚ö° Performance Settings**
```bash
CELERY_WORKER_CONCURRENCY=2
GUNICORN_WORKERS=4
GUNICORN_TIMEOUT=120
LOG_LEVEL=INFO
```

## üìß **Optional: Email Notifications**

### **Gmail SMTP Setup**
```bash
# 1. Enable 2FA on Gmail
# 2. Generate App Password: https://myaccount.google.com/apppasswords
# 3. Add to environment variables:

EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-16-char-app-password
```

## üìä **Optional: Google Sheets Integration**

### **Service Account Setup**
```bash
# 1. Go to: https://console.cloud.google.com
# 2. Create new project
# 3. Enable Google Sheets API
# 4. Create Service Account
# 5. Download JSON credentials
# 6. Share spreadsheet with service account email
# 7. Add to environment variables:

SHEETS_CREDENTIALS_JSON={"type":"service_account",...}
SHEETS_SPREADSHEET_ID=1ABCdefGHI...
```

## üí≥ **Optional: Payment Gateway**

### **Razorpay Setup (India)**
```bash
# 1. Sign up at: https://razorpay.com
# 2. Get API keys from dashboard
# 3. Add to environment variables:

RAZORPAY_KEY_ID=rzp_test_your_key_id
RAZORPAY_KEY_SECRET=your_razorpay_secret
ENABLE_ONLINE_PAYMENTS=True
```

## üöÄ **Deployment Checklist**

### **Pre-Deployment**
- [ ] All required services created
- [ ] Environment variables configured
- [ ] Secrets generated and stored securely
- [ ] Domain configured (if using custom domain)

### **Post-Deployment**
- [ ] Database migrations run
- [ ] Superuser created
- [ ] Static files collected
- [ ] Health check passing
- [ ] Telegram bot responding
- [ ] Admin panel accessible

### **Testing**
- [ ] Web interface loads
- [ ] Scanner works with QR codes
- [ ] Telegram bot commands work
- [ ] API endpoints respond
- [ ] Payment flow works (if enabled)
- [ ] Email notifications work (if enabled)

## üîç **Monitoring & Maintenance**

### **Health Checks**
```bash
# Application health
https://your-app.onrender.com/health/

# API status
https://your-app.onrender.com/api/v1/health/

# Admin panel
https://your-app.onrender.com/admin/
```

### **Log Monitoring**
- Check Render dashboard logs regularly
- Monitor for error patterns
- Set up alerts for critical issues

### **Backup Strategy**
- Database: Render PostgreSQL auto-backups
- Custom backups: Use management commands
- Monitor backup success in logs

## üí∞ **Cost Estimation**

### **Minimum Production Setup**
- Render Web Service: $7/month (Starter)
- Render PostgreSQL: $7/month (Starter)
- Upstash Redis: Free tier
- Cloudinary: Free tier
- **Total: ~$14/month**

### **Full Production Setup**
- Render Web Service: $25/month (Standard)
- Render PostgreSQL: $20/month (Standard)
- Upstash Redis: $10/month (Pro)
- Cloudinary: $89/month (Plus)
- **Total: ~$144/month**

## üÜò **Support & Troubleshooting**

### **Common Issues**
1. **Build failures**: Check Dockerfile and dependencies
2. **Database errors**: Verify DATABASE_URL format
3. **Bot not responding**: Check TELEGRAM_BOT_TOKEN
4. **Static files missing**: Run collectstatic command
5. **Redis connection**: Verify REDIS_URL format

### **Getting Help**
- Check Render documentation
- Review application logs
- Test locally with same environment variables
- Verify all external service credentials
